{% extends 'base.html' %}

{% block title %}ダッシュボード - {{ block.super }}{% endblock %}

{% block content %}
<div class="row">
    <!-- ポイント残高カード -->
    <div class="col-md-4 mb-4">
        <div class="card shadow-modern">
            <div class="card-body text-center">
                <div class="mb-3">
                    <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-10 p-3">
                        <i class="bi bi-coin text-primary" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <h5 class="card-title text-muted mb-2">総ポイント</h5>
                <h1 class="display-4 fw-bold text-gradient mb-2">{{ points_summary.total|default:0 }}</h1>
                <small class="text-muted">利用可能ポイント</small>
            </div>
        </div>
    </div>
    
    <!-- デジタルギフトポイント -->
    <div class="col-md-4 mb-4">
        <div class="card shadow-modern">
            <div class="card-body text-center">
                <div class="mb-3">
                    <div class="d-inline-flex align-items-center justify-content-center rounded-circle" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 1rem;">
                        <i class="bi bi-gift text-white" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <h5 class="card-title text-muted mb-2">デジタルギフト</h5>
                <h2 class="fw-bold mb-2" style="color: #059669;">{{ points_summary.digital_gift|default:0 }}</h2>
                <small class="text-muted">Amazonギフト券など</small>
            </div>
        </div>
    </div>
    
    <!-- 企業商品ポイント -->
    <div class="col-md-4 mb-4">
        <div class="card shadow-modern">
            <div class="card-body text-center">
                <div class="mb-3">
                    <div class="d-inline-flex align-items-center justify-content-center rounded-circle" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); padding: 1rem;">
                        <i class="bi bi-box text-white" style="font-size: 2rem;"></i>
                    </div>
                </div>
                <h5 class="card-title text-muted mb-2">企業商品</h5>
                <h2 class="fw-bold mb-2" style="color: #1d4ed8;">{{ points_summary.corporate_product|default:0 }}</h2>
                <small class="text-muted">企業オリジナル商品</small>
            </div>
        </div>
    </div>
</div>

<!-- 期限間近の警告 -->
{% if expiring_count > 0 %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i>
            <strong>注意:</strong> {{ expiring_count }}件のポイントが30日以内に期限切れになります。
            <a href="{% url 'point_history' %}?status=active" class="alert-link">詳細を確認</a>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <!-- クイックアクション -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">クイックアクション</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'product_list' %}" class="btn btn-primary">
                        <i class="bi bi-cart"></i> 商品を交換する
                    </a>
                    <a href="{% url 'point_history' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-clock-history"></i> ポイント履歴を見る
                    </a>
                    {% if user.is_admin %}
                    <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-danger">
                        <i class="bi bi-gear"></i> 管理画面
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- 最近のポイント履歴 -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">最近のポイント履歴</h5>
            </div>
            <div class="card-body">
                {% if recent_points %}
                <div class="list-group list-group-flush">
                    {% for point in recent_points %}
                    <div class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="fw-bold">{{ point.category }}</div>
                            <small class="text-muted">{{ point.reason }}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-primary rounded-pill">+{{ point.amount }}</span>
                            <br>
                            <small class="text-muted">{{ point.issued_at|date:"m/d" }}</small>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="mt-3">
                    <a href="{% url 'point_history' %}" class="btn btn-sm btn-outline-primary">
                        すべて見る
                    </a>
                </div>
                {% else %}
                <p class="text-muted mb-0">まだポイントが付与されていません。</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- 期限間近のポイント -->
{% if expiring_points %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0 text-warning">
                    <i class="bi bi-clock"></i> 期限間近のポイント
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>カテゴリ</th>
                                <th>残りポイント</th>
                                <th>有効期限</th>
                                <th>付与理由</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for point in expiring_points %}
                            <tr>
                                <td>{{ point.category }}</td>
                                <td>{{ point.remaining_amount }}</td>
                                <td class="text-warning">{{ point.expires_at|date:"Y/m/d" }}</td>
                                <td>{{ point.reason }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
